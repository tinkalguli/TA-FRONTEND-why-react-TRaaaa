<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Watch List</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <section class="max-w-lg bg-green-300 p-6 mx-auto my-20 rounded">
        <form action="" id="input-form">
            <input type="text" placeholder="Enter movie name" class="w-full px-2 py-1">
        </form>
        <ul id="movies-container"></ul>
    </section>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        (function main() {
            let movieList = JSON.parse(localStorage.getItem("movies")) || [];
            let inputForm = document.querySelector("#input-form");
            
            class Movie {
                constructor(name) {
                    this.name =  name;
                    this.isWatched = false;
                }
            }
            
            function handleInputEvents(event) {
                event.preventDefault();
                let name = event.target.children[0].value;
                event.target.children[0].value = '';
                movieList.push(new Movie(name));
                localStorage.setItem("movies", JSON.stringify(movieList));
                createUi(movieList);
            };

            function handleButtonEvents(event) {
                let id = +event.target.dataset.id;
                movieList[id].isWatched = !movieList[id].isWatched;
                localStorage.setItem("movies", JSON.stringify(movieList));
                createUi(movieList);
            }

            function createUi(movieList) {
                let moviesContainer = document.querySelector("#movies-container");

                let ui = movieList.map((movie, i) => {
                    return <li className="movie">
                                <span className="movie-name">{movie.name}</span>
                                <button className="button" data-id={i}>
                                    {movie.isWatched ? "Watched" : "To Watch"}
                                </button>
                           </li>;
                });

                ReactDOM.render(ui, moviesContainer);

                let allButton = document.querySelectorAll(".button");

                [...allButton].forEach(button => {
                    button.addEventListener("click", handleButtonEvents);
                });
            }
            createUi(movieList);
            inputForm.addEventListener("submit", handleInputEvents);
        })();
    </script>
</body>
</html>